<html>
  <head>
    <script src="id3.js"></script>
    <script src="vis.min.js"></script>
    <script src="html_gen.js"></script>
  </head>
  <body>
    <a href="https://github.com/sswly/sswly.github.io"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>
    <select id="data_type">
      <option>JSON</option>
      <option>CSV</option>
    </select>
    <button onClick="run()">Run</button>
    <br>
    <textarea  id="data" rows="3" cols="80">
      
    </textarea>
    <hr><br>
    <h2>Testing</h2>
    <table id="test_table">
    </table>
    <hr><br>
    <h2>Learning</h2>
    <div id="customized_decision_tree" style="float:left;width:50%"></div>
    <div style="float:right;width:50%" id="sample_set">
    </div>
    <script>
      var gAttrs = [];
      var gAttr;
      function test() {
        var conditions = {};
        gAttrs.forEach(function(item, index){
          conditions[item] = document.getElementById(item).value;
        });
        document.getElementById('result').innerHTML = ID3.makeDecision(gAttr, conditions);
      }
      
      function getAllAttrs(data) {
        var attrs = [];
        data.forEach(function(item, index){
          Object.keys(item).forEach(function(attr, index){  
            if (attrs.indexOf(attr) == -1) {
              attrs.push(attr);
            }
          });
        });
        return attrs;
      }
      
      function genTablehead(cols) {
        var tablehead = "";
        cols.forEach(function(item, index){
          tablehead += "<th>" + item + "</th>";
        });
        return tablehead;
      }
      
      function run() {
        var data = JSON.parse(document.getElementById("data").value.replace(/(^\s*)|(\s*$)/g,""));
        console.log(JSON.stringify(data));
        var tableHead = getAllAttrs(data);
        
        var tableContent = "<tr>";
        tableContent += genTablehead(tableHead);
        tableContent += "</tr>";
        
        gAttr = tableHead.slice();
        gAttr.splice(0, 2);
        var testTableContent = "<tr><th>Result</th>";
        testTableContent += genTablehead(gAttr);
        testTableContent += "</tr>";
        
        var testSelection = [];
        data.forEach(function(row, index){
          var id = 0;
          tableContent += "<tr>";
          tableHead.forEach(function(cell, index){  
            tableContent += "<td>" + row[cell] + "</td>";
            if (testSelection[id] == undefined) {
              testSelection[id] = "" + row[cell];
            } else if (testSelection[id].indexOf("" + row[cell]) < 0) {
              testSelection[id] += "," + row[cell];
            }
            id++;
          });
          tableContent += "</tr>";
        });
        testSelection.splice(0, 2);
        
        var id = 0;
        testTableContent += "<tr>";
        testTableContent += "<td><span id='result'></span></td>";
        testSelection.forEach(function(item, index){
          testTableContent += "<td>" + HtmlSelect.generate(gAttrs[id], item.split(",")) + "</td>";
          id++;
        });
        testTableContent += "<td><button autofocus onclick='test()'>Test</button></td></tr>";
        console.log(JSON.stringify(testSelection));
        
        document.getElementById("test_table").innerHTML = testTableContent;
        document.getElementById("sample_set").innerHTML = HtmlTable.generate(data);
        ID3.learn(document.getElementById('sample_set'), "Result");
        var container = document.getElementById('customized_decision_tree');
        var option = {
          layout: {
              hierarchical: {
                  direction: "UD",
                  sortMethod: "directed"
              }
          },
          physics: {
            barnesHut: {
              avoidOverlap: 1
            },
          },
        };
        var network = new vis.Network(container, ID3.decisionTree, option);
      }
    </script>
  </body>
</html
